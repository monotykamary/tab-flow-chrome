<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tab Flow</title>
  <link rel="stylesheet" href="/src/styles/globals.css">
  <script>
    // Prevent flash of unstyled content by applying theme immediately
    // Using synchronous approach for critical rendering path
    try {
      // Try to get from localStorage first (if previously cached)
      const cachedTheme = localStorage.getItem('theme-cache');
      if (cachedTheme) {
        const parsed = JSON.parse(cachedTheme);
        if (parsed.theme === 'dark' || 
            (parsed.theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        }
        document.documentElement.setAttribute('data-accent', parsed.accentColor || 'blue');
      }
    } catch (e) {
      // Fallback to system preference
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
      }
    }
    
    // Then update from chrome storage
    chrome.storage.local.get(['settings']).then(storage => {
      const settings = storage.settings || {};
      const theme = settings.theme || 'system';
      const accentColor = settings.accentColor || 'blue';
      
      // Cache for next time
      localStorage.setItem('theme-cache', JSON.stringify({ theme, accentColor }));
      
      // Apply theme
      if (theme === 'dark' || 
          (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
      
      // Apply accent color
      document.documentElement.setAttribute('data-accent', accentColor);
    });
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/popup.tsx"></script>
</body>
</html>